{"version":3,"sources":["app/workout1.js"],"names":["ctx","next","wc","token","encodingAESKey","corpID","str","request","body","Buffer","wxBody","plainWx","decryptMsg","query","fs","writeFile","workout1","require","config","wechat"],"mappings":";;;;;;;;+BASA,WAAwBA,GAAxB,EAAsCC,IAAtC,EAA2E;AACzE,UAAMC,KAAK,8BAAkBC,KAAlB,EAAyBC,cAAzB,EAAyCC,MAAzC,CAAX;AACA,QAAIC,MAAM,EAAV;AACA,QAAK,OAAON,IAAIO,OAAJ,CAAYC,IAAnB,IAA2B,QAA3B,IAAuCR,IAAIO,OAAJ,CAAYC,IAAZ,YAA4BC,MAAxE,EAAgF;AAC9E,YAAMC,SAASV,IAAIO,OAAJ,CAAYC,IAA3B;AACA,YAAMG,UAAUT,GAAGU,UAAH,CAAcZ,IAAIa,KAAlB,EAAyBb,IAAIO,OAAJ,CAAYC,IAArC,CAAhB;AACAF,YAAO;;EAAA,CAETI,MAAO;;;EAAA,CAGP,mBAAOC,OAAP,CAAgB;KALd;AAOD,KAVD,MAUO;AACL,YAAMA,UAAUT,GAAGU,UAAH,CAAcZ,IAAIa,KAAlB,EAAyBb,IAAIO,OAAJ,CAAYC,IAArC,CAAhB;AACAF,YAAO;;;EAAA,CAGT,mBAAON,IAAIO,OAAJ,CAAYC,IAAnB,CAAyB;;;EAAA,CAGzB,mBAAOG,OAAP,CAAgB;KANd;AAQD;AACDG,OAAGC,SAAH,CAAa,qBAAS,QAAT,CAAb,EAAiCT,GAAjC;AACF;AACC,G;;kBA1BcU,Q;;;;;AANf;;AAEA;;;;AAJA;AACA,MAAMF,KAAKG,QAAQ,gBAAR,EAA0BH,EAArC;;AAIA,MAAMI,SAASD,QAAQ,sBAAR,CAAf;AACA,MAAM,EAAEd,KAAF,EAASC,cAAT,EAAyBC,MAAzB,KAAmCa,OAAOC,MAAhD;;QA+BEH,Q,GAAAA,Q","file":"workout1.js","sourcesContent":["// @flow\n//const util = require('util');\nconst fs = require('../utils/fs.js').fs;\nimport { toTmpDir, format } from '../utils/tools.js';\nimport type { Context } from 'koa';\nimport { WXBizMsgCrypt } from '../wxlib/wxmsgcrypt.js';\nconst config = require('../../priv/config.js');\nconst { token, encodingAESKey, corpID} = config.wechat;\n\nasync function workout1(ctx: Context, next: Promise<mixed>): Promise<void> {\n  const wc = new WXBizMsgCrypt(token, encodingAESKey, corpID);\n  let str = '';\n  if ( typeof ctx.request.body == 'string' || ctx.request.body instanceof Buffer) {\n    const wxBody = ctx.request.body;\n    const plainWx = wc.decryptMsg(ctx.query, ctx.request.body);\n    str = `\nwxBody:\n${wxBody}\n-------------------\nplainWx:\n${format(plainWx)}\n    `;\n  } else {\n    const plainWx = wc.decryptMsg(ctx.query, ctx.request.body);\n    str = `\nsomething wrong.\nwxBody:\n${format(ctx.request.body)}\n-------------------\nplainWx:\n${format(plainWx)}\n    `\n  }\n  fs.writeFile(toTmpDir('wxbody'), str);\n//  ctx.\n}\n\nexport {\n  workout1\n}\n"],"sourceRoot":"/home/iamchenxin/project/workout/wxts2/src"}